<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.76.5"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Using Build Tools From Containers&nbsp;&ndash;&nbsp;Today I Learned</title><link rel=stylesheet href=/today-i-learned/css/core.min.26e6d94f4c8a8ad1f2700ad4e269c6f9651f8beb5e5f8be05d5dc6e12a76c968585cde9fc585afee9a5be325c54837da.css integrity=sha384-JubZT0yKitHycArU4mnG+WUfi+teX4vgXV3G4Sp2yWhYXN6fxYWv7ppb4yXFSDfa><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Build Tools From Containers"><base href=https://reitzig.github.io/today-i-learned/><link rel=icon href="data:;base64,="><meta name=author content="Raphael Reitzig"><meta name=description content="You have to use a build tool that you do not want on your machine — what to do?
Run it from a container, of course!"><meta name=keywords content="Programming,Docker,Tool"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/today-i-learned/><span class="site name">Today I Learned</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/today-i-learned/tags/>Tags</a><a class="nav item" href=impressum>About</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Using Build Tools From Containers</h1><p class="article date">2020-05-29<span class=lastmod> • edited 2020-06-22</span></p><p class="article github_edit"><a rel=nofollow href=https://github.com/reitzig/today-i-learned/edit/master/content/posts/2020-05-29-using-build-tools-from-containers.adoc></a></p><p class="article tweet_link"><a href=https://twitter.com/OmegaPolice/status/1266406792889860102><span class="iconfont icon-twitter"></span></a></p></section><article class="article markdown-body"><div class=paragraph><p>You have to use a build tool that you do not want on your machine — what to do?
Run it from a container, of course!</p></div><div class=paragraph><p>Fact: I do not like the JavaScript ecosystem,
so I do not want to install <code>npm</code> and the like only because someone forces me to use it.
For other tools or use cases, there may be more objective concerns.
The question remains the same: How do I use a tool I can or will not install?</p></div><div class=paragraph><p>Here is an idea:</p></div><div class="olist arabic"><ol class=arabic><li><p>Start a container with the tool and its dependencies;
most modern tools have images for CI pipelines.</p></li><li><p>Bind-mount the project directory into it.</p></li><li><p>Run the commands as you would usually do, but <em>in</em> the container.</p></li></ol></div><div class=paragraph><p>This is, of course, not a novel idea;
one half of GitHub Actions rests on this approach, after all.
Wrapping it up so that it is easy to adopt and use holds some interest for me, though.</p></div><div class=paragraph><p>Specifically, for the example for Node.js, I created a Bash script <code>$</code> along the lines of this:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>if ! container_exists &#34;${container_name}&#34;; then
    docker run \
        --detach --rm \
        --name &#34;${container_name}&#34; \
        -v &#34;$PWD&#34;:/usr/src/app \
        -w /usr/src/app \
        node:12-slim \
        tail -f /dev/null # block
fi

docker exec -it \
    -w /usr/src/app \
    &#34;${container_name}&#34; \
    &#34;${@}&#34;</code></pre></div></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content><div class=paragraph><p>I left out some fluff parts, and
I also added some setup code to the container creation part for convenience.</p></div><div class=paragraph><p>Full source: <a href=https://gist.github.com/reitzig/3b41025ed3d3ebc12e49fa692a6055da>Gist</a></p></div></td></tr></tbody></table></div><div class=paragraph><p>So the first call would start the container — which is quick once you have the image — taking care to keep it alive.
Then we just forward all parameters,
including the actual command we want to run,
to the containers.</p></div><div class=paragraph><p>I used it like so (in an existing project):</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>./$ npm install
./$ ncc index.js</code></pre></div></div><div class="admonitionblock important"><table><tbody><tr><td class=icon><i class="fa icon-important" title=Important></i></td><td class=content>All project files will be generated <em>outside</em> of the container;
you will have to <code>.gitignore</code> and clean up just like you usually would.
Do not forget <code>docker kill $container_name</code> either!</td></tr></tbody></table></div><div class=paragraph><p>Future work:</p></div><div class=ulist><ul><li><p>Have the container automatically shut down after some idle time.</p></li><li><p>Generalize the script to make it a proper tool.
(I solved a similar problem once <a href=https://github.com/reitzig/texlive-docker>before</a>.)</p></li><li><p>Use a container runner that does not create files with <code>root:root</code> ownership.</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><i class="fa icon-note" title=Note></i></td><td class=content>I have since released
<a href=https://github.com/reitzig/container-do><code>container-do</code></a>
which is more general and robust than this script here.</td></tr></tbody></table></div></article><section class="article labels"><a class=tag href=/today-i-learned/tags/programming/>Programming</a><a class=tag href=/today-i-learned/tags/docker/>Docker</a><a class=tag href=/today-i-learned/tags/tool/>Tool</a></section><section class="article tweet">Comment & Share on 
    <a href=https://twitter.com/OmegaPolice/status/1266406792889860102>Twitter&nbsp;<span class="iconfont icon-twitter"></span></a></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/today-i-learned/posts/2020-06-10-targeted-docker-inspection/><span class="iconfont icon-article"></span>Targeted Docker Inspection</a></p><p><a class=link href=/today-i-learned/posts/2020-05-26-hacking-cucumber-feature-isolation-with-docker/><span class="iconfont icon-article"></span>Hacking Cucumber: Isolating Features With Docker</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>© 2020 Raphael Reitzig<br>This work is licensed under a
<a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License
</a>.<br><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=border-width:0 src=cc-by-80x15.png></a></p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank>Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section><script src=/today-i-learned/js/hljs.min.0799348a91dce12c6be4a73f943cfe78f181f4e6f6ec35c4af0fca1de377879f77cfab03c30f03a174d675737b5a9314.js integrity=sha384-B5k0ipHc4Sxr5Kc/lDz+ePGB9Ob27DXErw/KHeN3h593z6sDww8DoXTWdXN7WpMU></script><script>hljs.initHighlightingOnLoad();</script></body></html>