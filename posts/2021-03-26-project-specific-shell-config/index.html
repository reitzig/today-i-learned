<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>Project-Specific Shell Configuration&nbsp;&ndash;&nbsp;Today I Learned</title><link rel=stylesheet href=/today-i-learned/css/core.min.399dab7fa1f40244041d4229846dfd5482112986bf439798a00f891ea52d6110509f13568b777a307148a4da24754429.css integrity=sha384-OZ2rf6H0AkQEHUIphG39VIIRKYa/Q5eYoA+JHqUtYRBQnxNWi3d6MHFIpNokdUQp><meta name=twitter:card content="summary"><meta name=twitter:title content="Project-Specific Shell Configuration"><base href=https://reitzig.github.io/today-i-learned/><link rel=icon href="data:;base64,="><meta name=author content="Raphael Reitzig"><meta name=description content="
If you have many different projects, each with their own tool stack, SaaS providers, and whatnot,
you may have been annoyed at all projects sharing the same configuration stored in your home folder.
Here is how you can isolate projects using direnv.
"><meta name=keywords content="Tool,Shell"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">Today I Learned</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/tags/>Tags</a><a class="nav item" href=impressum>About</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Project-Specific Shell Configuration</h1><p class="article date">2021-03-26<span class=lastmod> • edited 2022-03-15</span></p><p class="article github_edit"><a rel=nofollow href=https://github.com/reitzig/today-i-learned/edit/master/content/posts/2021-03-26-project-specific-shell-config.adoc></a></p><p class="article tweet_link"><a href=https://twitter.com/OmegaPolice/status/1375535323304882183><span class="iconfont icon-twitter"></span></a></p></section><article class="article markdown-body"><div class=paragraph><p>If you have many different projects, each with their own tool stack, SaaS providers, and whatnot,
you may have been annoyed at all projects sharing the same configuration stored in your home folder.
Here is how you can isolate projects using <a href=https://github.com/direnv/direnv>direnv</a>.</p></div><div class=paragraph><p>The principle is rather simple:</p></div><div class=ulist><ul><li><p>You add a file called <code>.envrc</code> to any directory you need specific setup for,</p></li><li><p>add instructions that update the environment as necessary, and</p></li><li><p>run <code>direnv allow</code> once to confirm you want to apply what you just did.</p></li></ul></div><div class=paragraph><p>From then on, whenever you visit that directory (or a sub-directory) in your shell,
your custom environment (variables) will be loaded.</p></div><div class="admonitionblock tip"><table><tbody><tr><td class=icon><img src=assets/icons/tip.svg alt=Tip></td><td class=content><div class=paragraph><p>Environment hygiene is particularly important when you let your shell prompt display different information,
for instance with <a href=https://github.com/starship/starship>starship</a>.
Your prompt can get quite crowded otherwise!</p></div></td></tr></tbody></table></div><div class=paragraph><p>That is all very abstract — here are a few concrete examples that I have been using every day.</p></div><div class=dlist><dl><dt class=hdlist1><strong>Kubernetes</strong></dt><dd><p>By default, <code>kubectl</code> will store all contexts in <code>.kube/config</code>.
That's fine for my Minikube setup, but I prefer to keep project-specific environments separate;
not least, I want to be sure that credentials are <em>gone</em> when I delete the project folder!</p></dd></dl></div><div class=listingblock><div class=title><code>kube_config.yaml</code></div><div class=content><pre class=highlight><code class=language-yaml data-lang=yaml>apiVersion: v1
# &lt;snip&gt;</code></pre></div></div><div class=listingblock><div class=title><code>.envrc</code></div><div class=content><pre class=highlight><code class=language-bash data-lang=bash>export KUBECONFIG=&#34;$(realpath .)/kube_config.yaml:${HOME}/.kube/config&#34;</code></pre></div></div><div class=paragraph><p>Here, I <em>add</em> the local config; replacing it would be just as easy.</p></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><img src=assets/icons/note.svg alt=Note></td><td class=content><div class=paragraph><p>The invocation of <code>realpath</code> ensures that <code>KUBECONFIG</code> refers to the correct file,
even if I switch to a sub-directory later.
If I ever do <em>not</em> want that, I can use a relative path.</p></div><div class=paragraph><p>The <a href=https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/#merging-kubeconfig-files>order matters</a>
as well: the <em>first</em> entry takes precedence, and is where <code>kubectl</code> will write to.</p></div></td></tr></tbody></table></div><div class=paragraph><p>I have also taken to adding the output of <code>minikube docker-env</code> so that I can directly interface with the Docker demon inside</p></div><div class=dlist><dl><dt class=hdlist1><strong>gcloud</strong></dt><dd><p>Similar approach for a Google Cloud project, also adding the project identifier:</p></dd></dl></div><div class=listingblock><div class=title><code>.envrc</code></div><div class=content><pre class=highlight><code class=language-bash data-lang=bash>export CLOUDSDK_CONFIG=$(realpath .)/gcloud-config
export PROJECT_ID=my-project</code></pre></div></div><div class=paragraph><p>I was quite appalled by how invasive the Google Cloud SDK acts on the shell environment in general;
I might re-install it in a place that is not usually on the <code>PATH</code>, and
then add it selectively only in matching project folders.</p></div><div class=dlist><dl><dt class=hdlist1><strong>Python</strong></dt><dd><p>When I run <code>venv/bin/pytest</code>, it needs help to find all the includes.
Simple fix:</p></dd></dl></div><div class=listingblock><div class=title><code>.envrc</code></div><div class=content><pre class=highlight><code class=language-bash data-lang=bash>export PYTHONPATH=&#34;$(realpath src):$(realpath test)&#34;</code></pre></div></div></article><section class="article labels"><a class=tag href=/tags/tool/>Tool</a><a class=tag href=/tags/shell/>Shell</a></section><section class="article tweet">Comment & Share on 
    <a href=https://twitter.com/OmegaPolice/status/1375535323304882183>Twitter&nbsp;<span class="iconfont icon-twitter"></span></a></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/today-i-learned/posts/2020-11-12-mirror-github-to-gitlab-registry/><span class="iconfont icon-article"></span>Private GitLab mirror of a public GitHub repository</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>© 2020 &ndash; 2022 Raphael Reitzig<br>This work is licensed under a
<a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0 International License
</a>.<br><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt='Creative Commons License' style=border-width:0 src=cc-by-80x15.png></a></p><p class=powerby><span>Powered&nbsp;by&nbsp;</span><a href=https://gohugo.io target=_blank>Hugo</a><span>&nbsp;&&nbsp;</span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section><script src=/today-i-learned/js/hljs.min.6f979583f61e4ec5f0b94f94eab2e130ee628032474d374414dba4e33cc12097a0d01fe65b33378b23f6d3b053b95445.js integrity=sha384-b5eVg/YeTsXwuU+U6rLhMO5igDJHTTdEFNuk4zzBIJeg0B/mWzM3iyP207BTuVRF></script><script>hljs.initHighlightingOnLoad()</script></body></html>